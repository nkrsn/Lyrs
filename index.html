<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Complete the Lyric Challenge</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 2rem auto;
      padding: 0 1rem;
    }
    h1 { text-align: center; }
    select, button, textarea {
      font-size: 1rem;
      margin: 0.5rem 0;
      padding: 0.5rem;
    }
    #snippetDisplay {
      white-space: pre-wrap;
      border: 1px solid #ccc;
      padding: 1rem;
      margin-top: 1rem;
      background: #f9f9f9;
    }
    #result {
      font-weight: bold;
      margin-top: 1rem;
      white-space: pre-wrap;
    }
    .placeholder {
      font-weight: bold;
      background-color: #ff0;
    }
  </style>
</head>
<body>
  <h1>Complete the Lyric Challenge</h1>
  <p>Select a song to practice completing a snippet of its lyrics:</p>
  <select id="songSelect">
    <option value="">--Select a Song--</option>
  </select>
  <br>
  <button id="fetchButton">Fetch Lyrics &amp; Prepare Quiz</button>
  <div id="snippetDisplay"></div>
  <div id="quizSection" style="display:none;">
    <p>Fill in the missing words (3–10 words):</p>
    <textarea id="userInput" rows="2" cols="50"></textarea><br>
    <button id="checkButton">Check Answer</button>
    <button id="showAnswerButton">Show Answer</button>
    <div id="result"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Sample list of songs (expand as needed)
      const songs = [
        {artist: "Queen", title: "Bohemian Rhapsody"},
        {artist: "John Lennon", title: "Imagine"},
        {artist: "Gloria Gaynor", title: "I Will Survive"},
        {artist: "Michael Jackson", title: "Billie Jean"},
        {artist: "Neil Diamond", title: "Sweet Caroline"}
        // Add more songs here...
      ];

      // Populate the dropdown menu.
      const songSelect = document.getElementById('songSelect');
      songs.forEach((song, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = `${song.title} by ${song.artist}`;
        songSelect.appendChild(option);
      });

      let hiddenText = "";  // The text that has been hidden.
      let snippetWithPlaceholder = "";  // The displayed snippet.

      // Fetch lyrics from the free lyrics.ovh API.
      async function fetchLyrics(artist, title) {
        try {
          const response = await fetch(`https://api.lyrics.ovh/v1/${encodeURIComponent(artist)}/${encodeURIComponent(title)}`);
          const data = await response.json();
          if (data.lyrics) {
            return data.lyrics;
          } else {
            return "Lyrics not found.";
          }
        } catch (error) {
          console.error(error);
          return "Error fetching lyrics.";
        }
      }

      // Prepare a snippet quiz:
      // 1. Choose a contiguous snippet of 6 lines from the full lyrics.
      // 2. In one randomly chosen line, hide a block of 3–10 words.
      function prepareSnippetQuiz(lyrics) {
        const lines = lyrics.split('\n').filter(line => line.trim() !== "");
        if (lines.length < 6) {
          return { snippet: lyrics, hidden: "" };
        }
        // Choose a snippet of 6 consecutive lines.
        const snippetLength = 6;
        const startIndex = Math.floor(Math.random() * (lines.length - snippetLength + 1));
        let snippetLines = lines.slice(startIndex, startIndex + snippetLength);

        // Select one line from the snippet that has at least 5 words.
        let candidateIndices = [];
        snippetLines.forEach((line, idx) => {
          const wordCount = line.split(/\s+/).filter(word => word.trim() !== "").length;
          if (wordCount >= 5) candidateIndices.push(idx);
        });
        if (candidateIndices.length === 0) candidateIndices = [0];
        const chosenLineIndex = candidateIndices[Math.floor(Math.random() * candidateIndices.length)];
        let targetLine = snippetLines[chosenLineIndex];
        const words = targetLine.split(' ').filter(word => word.trim() !== "");
        const totalWords = words.length;

        // Determine block length (between 3 and 10 words, but not more than available words - 1).
        const minBlock = 3;
        const maxBlock = Math.min(10, totalWords - 1);
        const blockLength = Math.floor(Math.random() * (maxBlock - minBlock + 1)) + minBlock;
        const maxStart = totalWords - blockLength;
        const wordStart = Math.floor(Math.random() * (maxStart + 1));
        hiddenText = words.slice(wordStart, wordStart + blockLength).join(' ');

        // Replace the selected words with a placeholder span.
        const placeholder = `<span class="placeholder">________</span>`;
        const newLineWords = words.slice(0, wordStart)
                                .concat([placeholder])
                                .concat(words.slice(wordStart + blockLength));
        snippetLines[chosenLineIndex] = newLineWords.join(' ');

        return { snippet: snippetLines.join('\n'), hidden: hiddenText };
      }

      // Normalize text for basic comparison.
      function normalizeText(text) {
        return text.trim().toLowerCase().replace(/[^\w\s]|_/g, "").replace(/\s+/g, " ");
      }

      // Event: Fetch lyrics and prepare the quiz snippet.
      document.getElementById('fetchButton').addEventListener('click', async () => {
        const selectedIndex = songSelect.value;
        if (selectedIndex === "") {
          alert("Please select a song.");
          return;
        }
        const song = songs[selectedIndex];
        document.getElementById('snippetDisplay').innerHTML = "Loading lyrics...";
        const lyrics = await fetchLyrics(song.artist, song.title);
        if (lyrics.startsWith("Error") || lyrics.startsWith("Lyrics not found")) {
          document.getElementById('snippetDisplay').innerHTML = lyrics;
          document.get
